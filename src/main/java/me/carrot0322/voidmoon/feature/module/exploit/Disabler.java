package me.carrot0322.voidmoon.feature.module.exploit;

import com.google.common.eventbus.Subscribe;
import me.carrot0322.voidmoon.event.impl.MotionEvent;
import me.carrot0322.voidmoon.event.impl.PacketEvent;
import me.carrot0322.voidmoon.feature.module.Module;
import me.carrot0322.voidmoon.feature.setting.Setting;
import me.carrot0322.voidmoon.util.client.PacketUtil;
import net.minecraft.network.play.client.C07PacketPlayerDigging;
import net.minecraft.network.play.client.C0BPacketEntityAction;
import net.minecraft.network.play.client.C17PacketCustomPayload;
import net.minecraft.util.BlockPos;
import net.minecraft.util.EnumFacing;

import static me.carrot0322.voidmoon.util.client.Util.mc;

public class Disabler extends Module {
    enum cate {
        AntiCheat,
        Setting
    }
    public Setting<cate> category = register(new Setting("Category", cate.AntiCheat));
    private boolean c(cate catego){
        return category.getValue() == catego;
    }

    // AC
    public Setting<Boolean> vulcan = register(new Setting("Vulcan", false, v -> c(cate.AntiCheat)));

    // Setting
    enum disabler {
        Vulcan
    }
    public Setting<disabler> listCategory = register(new Setting("disabler", disabler.Vulcan, v -> c(cate.Setting)));
    private boolean l(disabler d){
        return listCategory.getValue() == d;
    }

    // vulcan
    public Setting<Boolean> vulcanSprint = register(new Setting("Omni-Sprint", true, v -> c(cate.Setting) && l(disabler.Vulcan)));
    public Setting<Boolean> vulcanScaffold = register(new Setting("Scaffold", true, v -> c(cate.Setting) && l(disabler.Vulcan)));
    public Setting<Boolean> vulcanMovement = register(new Setting("strafe & jump", true, v -> c(cate.Setting) && l(disabler.Vulcan)));
    public Setting<Boolean> vulcanFastUse = register(new Setting("FastUse", true, v -> c(cate.Setting) && l(disabler.Vulcan)));
    public Setting<Boolean> vulcanMisc = register(new Setting("AutoBlock & BadPacket", true, v -> c(cate.Setting) && l(disabler.Vulcan)));

    public Disabler() {
        super("Disabler", "disable ac", Category.EXPLOIT, true, false, false);
        setInstance();
    }

    //
    // Vulcan
    //

    @Subscribe
    public void onPacketVulcan(PacketEvent e){
        if(vulcanMisc.getValue() && e.packet instanceof C17PacketCustomPayload)
            e.cancel();
    }

    @Subscribe
    public void onPreMotionVulcan(MotionEvent.PRE e){
        if(vulcanSprint.getValue()){
            PacketUtil.sendPacketNoEvent(new C0BPacketEntityAction(mc.thePlayer, C0BPacketEntityAction.Action.START_SPRINTING));
            PacketUtil.sendPacketNoEvent(new C0BPacketEntityAction(mc.thePlayer, C0BPacketEntityAction.Action.STOP_SPRINTING));
        }
        if(vulcanScaffold.getValue()){
            PacketUtil.sendPacketNoEvent(new C0BPacketEntityAction(mc.thePlayer, C0BPacketEntityAction.Action.START_SPRINTING));
            PacketUtil.sendPacketNoEvent(new C0BPacketEntityAction(mc.thePlayer, C0BPacketEntityAction.Action.STOP_SPRINTING));
            if(mc.thePlayer.ticksExisted % 10 == 0){
                PacketUtil.sendPacketNoEvent(new C0BPacketEntityAction(mc.thePlayer, C0BPacketEntityAction.Action.START_SNEAKING));
                PacketUtil.sendPacketNoEvent(new C0BPacketEntityAction(mc.thePlayer, C0BPacketEntityAction.Action.STOP_SNEAKING));
            }
        }
        if(vulcanMovement.getValue() && mc.thePlayer.ticksExisted % 5 == 0)
            PacketUtil.sendPacketNoEvent(new C07PacketPlayerDigging(C07PacketPlayerDigging.Action.STOP_DESTROY_BLOCK, new BlockPos(mc.thePlayer), EnumFacing.UP));
        if(vulcanFastUse.getValue() && mc.thePlayer.ticksExisted % 7 == 0)
            PacketUtil.sendPacketNoEvent(new C07PacketPlayerDigging(C07PacketPlayerDigging.Action.DROP_ITEM, BlockPos.ORIGIN, EnumFacing.DOWN));
    }

    //
    //
    //

    private static Disabler INSTANCE = new Disabler();

    public static Disabler getInstance() {
        if (INSTANCE == null)
            INSTANCE = new Disabler();
        return INSTANCE;
    }

    private void setInstance() {
        INSTANCE = this;
    }
}
